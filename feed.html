<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>TANAW ¬∑ Feed</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,1,0"/>
<link rel="stylesheet" href="style.css">
<style>
html, body { margin:0; padding:0; } body { overflow-y:auto; -webkit-overflow-scrolling:touch; }
.feed-app {
  width:100%;max-width:430px;margin:0 auto;
  background:#f5f5f5;display:block;
  padding-bottom:80px;
}

/* HEADER */
.feed-header {
  position:sticky;top:0;z-index:100;
  background:var(--primary);
  padding:14px 16px 12px;
  display:flex;align-items:center;justify-content:space-between;
}
.feed-header-title span { font-size:11px;color:rgba(255,255,255,.65);font-weight:500;letter-spacing:.6px;text-transform:uppercase;display:block; }
.feed-header-title h2   { font-size:22px;font-weight:700;color:#fff;margin:0;line-height:1.15; }

/* POINTS BUTTON */
.points-header-btn {
  position:relative;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:2px;
  background:rgba(255,255,255,.18);
  border:none;border-radius:16px;
  padding:8px 14px;
  cursor:pointer;
  min-width:64px;
}
.points-header-btn .material-symbols-rounded { font-size:22px;color:#fff; }
.points-header-btn .pts-label { font-size:9px;color:rgba(255,255,255,.7);font-weight:600;letter-spacing:.5px;text-transform:uppercase; }
.points-value {
  font-size:18px;font-weight:800;color:#fff;line-height:1;
}
.points-header-btn .pts-word { font-size:9px;color:rgba(255,255,255,.8);font-weight:600;letter-spacing:.4px; }

/* SECTION LABELS */
.section-label { font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;color:#999;padding:16px 16px 8px; }

/* CCTV PILLS */
.cctv-scroll { display:flex;gap:8px;padding:0 16px 14px;overflow-x:auto;scrollbar-width:none; }
.cctv-scroll::-webkit-scrollbar { display:none; }
.cctv-pill {
  flex-shrink:0;display:flex;align-items:center;gap:6px;
  padding:8px 14px;background:#fff;border-radius:50px;
  border:1.5px solid #e8e8e8;font-size:13px;font-weight:500;color:#444;
  cursor:pointer;transition:all .15s;white-space:nowrap;font-family:inherit;
}
.cctv-pill .material-symbols-rounded { font-size:15px;color:#bbb; }
.cctv-pill.active { background:var(--primary);border-color:var(--primary);color:#fff;box-shadow:0 4px 12px rgba(239,90,60,.3); }
.cctv-pill.active .material-symbols-rounded { color:rgba(255,255,255,.85); }

/* CCTV VIEWER */
.cctv-viewer { margin:0 16px 4px;border-radius:18px;overflow:hidden;background:#111;position:relative;display:none;box-shadow:0 8px 28px rgba(0,0,0,.22); }
.cctv-viewer.visible { display:block; }
.cctv-viewer img,.cctv-viewer video { width:100%;display:block;max-height:220px;object-fit:cover; }
.cctv-overlay { position:absolute;bottom:0;left:0;right:0;padding:28px 14px 12px;background:linear-gradient(transparent,rgba(0,0,0,.72)); }
.cctv-live-badge { display:inline-flex;align-items:center;gap:5px;background:#d32f2f;color:#fff;font-size:10px;font-weight:800;padding:3px 8px;border-radius:50px;letter-spacing:.6px;margin-bottom:5px; }
.cctv-live-dot { width:6px;height:6px;border-radius:50%;background:#fff;animation:livePulse 1.2s ease-in-out infinite; }
@keyframes livePulse { 0%,100%{opacity:1}50%{opacity:.25} }
.cctv-name { font-size:15px;font-weight:700;color:#fff; }
.cctv-sub  { font-size:12px;color:rgba(255,255,255,.65);margin-top:2px; }


/* FEED CARDS */
.feed-list-wrap { padding:0 16px 10px;display:flex;flex-direction:column;gap:10px; }
.feed-card {
  background:#fff;border-radius:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
  border-left:4px solid var(--type-color,#ddd);
  overflow:hidden;
  transition:transform .12s;
}
.feed-card:active { transform:scale(.99); }
.feed-card-top {
  padding:14px 14px 10px;
  display:flex;align-items:center;gap:14px;cursor:pointer;
}
.feed-icon-wrap { width:46px;height:46px;border-radius:14px;background:var(--type-bg,#f5f5f5);display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0; }
.feed-info { flex:1;min-width:0; }
.feed-info h4    { font-size:15px;font-weight:700;color:#1a1a1a;margin-bottom:2px; }
.feed-info p     { font-size:13px;color:#777;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis; }
.feed-info small { font-size:11px;color:#bbb; }
.feed-arrow .material-symbols-rounded { font-size:18px;color:#ddd; }

.feed-desc {
  padding:0 14px 10px;font-size:13px;color:#555;line-height:1.5;
  border-bottom:1px solid #f0f0f0;margin:0 14px;
}

/* ACTIONS BAR */
.feed-actions {
  display:flex;border-top:1px solid #f0f0f0;
}
.action-btn {
  flex:1;display:flex;align-items:center;justify-content:center;gap:6px;
  padding:10px 8px;background:none;border:none;
  font-size:13px;font-weight:500;color:#888;
  cursor:pointer;font-family:inherit;
  transition:all .15s;
  border-right:1px solid #f0f0f0;
}
.action-btn:last-child { border-right:none; }
.action-btn .material-symbols-rounded { font-size:18px; }
.action-btn:active { background:#f9f9f9; }

.like-btn.liked { color:#e53935; }
.like-btn.liked .material-symbols-rounded { color:#e53935; }
.comment-btn { color:#1565c0; }
.comment-btn .material-symbols-rounded { color:#1565c0; }

.feed-empty { text-align:center;color:#bbb;padding:40px 20px;font-size:14px; }
.feed-empty .material-symbols-rounded { font-size:52px;display:block;margin-bottom:10px;color:#ddd; }

/* COMMENT PANEL */
.comment-panel {
  position:fixed;
  top:0;bottom:0;
  left:50%;width:100%;max-width:430px;
  transform:translateX(50%) translateY(100%);
  z-index:600;background:#f5f5f5;
  transition:transform .3s cubic-bezier(.4,0,.2,1);
  display:flex;flex-direction:column;
}
.comment-panel.open { transform:translateX(-50%) translateY(0); }
.comment-panel.hidden { display:none; }

.comment-panel-header {
  background:var(--primary);
  padding:14px 16px;
  display:flex;align-items:center;gap:12px;
  flex-shrink:0;
}
.comment-panel-header button {
  width:38px;height:38px;background:rgba(255,255,255,.18);
  border:none;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;
}
.comment-panel-header button .material-symbols-rounded { font-size:20px;color:#fff; }
.comment-panel-header h3 { font-size:17px;font-weight:700;color:#fff;flex:1; }

.comment-list { flex:1;overflow-y:auto;padding:12px 16px;display:flex;flex-direction:column;gap:10px; }
.comment-item { display:flex;gap:10px;align-items:flex-start; }
.comment-avatar {
  width:36px;height:36px;border-radius:50%;
  background:var(--primary);color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:15px;font-weight:700;flex-shrink:0;
}
.comment-body { background:#fff;border-radius:14px 14px 14px 4px;padding:10px 12px;flex:1;box-shadow:0 1px 4px rgba(0,0,0,.06); }
.comment-name  { font-size:12px;font-weight:700;color:var(--primary); }
.comment-text  { font-size:14px;color:#1a1a1a;margin:3px 0 4px;line-height:1.4; }
.comment-time  { font-size:11px;color:#bbb; }
.comment-empty { text-align:center;color:#bbb;padding:32px 20px;font-size:14px; }
.comment-empty .material-symbols-rounded { font-size:40px;display:block;margin-bottom:8px;color:#ddd; }

.comment-input-bar {
  padding:12px 16px;background:#fff;
  border-top:1px solid #eee;
  display:flex;flex-direction:column;gap:8px;
  flex-shrink:0;
}
.comment-name-input {
  width:100%;padding:8px 12px;border:1.5px solid #e8e8e8;border-radius:10px;
  font-size:13px;font-family:inherit;outline:none;color:#333;background:#fafafa;
}
.comment-name-input:focus { border-color:var(--primary); }

.comment-text-row { display:flex;gap:8px;align-items:flex-end; }
.comment-text-input {
  flex:1;padding:10px 12px;border:1.5px solid #e8e8e8;border-radius:14px;
  font-size:14px;font-family:inherit;outline:none;resize:none;
  min-height:42px;max-height:100px;background:#fafafa;color:#333;
}
.comment-text-input:focus { border-color:var(--primary);background:#fff; }
.comment-send-btn {
  width:42px;height:42px;border-radius:50%;border:none;
  background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;
  cursor:pointer;flex-shrink:0;
}
.comment-send-btn .material-symbols-rounded { font-size:20px; }
.comment-send-btn:active { background:#d44a2e; }
</style>
</head>
<body>
<div class="feed-app">

  <!-- HEADER with Points -->
  <header class="feed-header">
    <div class="feed-header-title">
      <span>Naga City</span>
      <h2>Live Feed</h2>
    </div>
    <button class="points-header-btn" onclick="window.location.href='more.html'">
      <span class="material-symbols-rounded">emoji_events</span>
      <span class="points-value" id="pointsCount">0</span>
      <span class="pts-word">pts</span>
    </button>
  </header>

  <!-- CCTV -->
  <div class="section-label">üìπ Live CCTV</div>
  <div class="cctv-scroll" id="cctvPills">
    <button class="cctv-pill" onclick="openLiveArea('Magsaysay Ave',this)">
      <span class="material-symbols-rounded">videocam</span>Magsaysay Ave
    </button>
    <button class="cctv-pill" onclick="openLiveArea('Maharlika Highway',this)">
      <span class="material-symbols-rounded">videocam</span>Maharlika Hwy
    </button>
    <button class="cctv-pill" onclick="openLiveArea('Diversion Road',this)">
      <span class="material-symbols-rounded">videocam</span>Diversion Rd
    </button>
    <button class="cctv-pill" onclick="openLiveArea('Almeda Highway',this)">
      <span class="material-symbols-rounded">videocam</span>Almeda Hwy
    </button>
    <button class="cctv-pill" onclick="openLiveArea('Pe√±afrancia Ave',this)">
      <span class="material-symbols-rounded">videocam</span>Pe√±afrancia Ave
    </button>
  </div>
  <div class="cctv-viewer" id="cctvViewer">
    <img id="liveMediaImg" src="" style="display:none" alt="CCTV">
    <video id="liveMediaVid" autoplay loop muted playsinline style="display:none"></video>
    <div class="cctv-overlay">
      <div class="cctv-live-badge"><span class="cctv-live-dot"></span>LIVE</div>
      <div class="cctv-name" id="liveTitle"></div>
      <div class="cctv-sub"  id="liveSub"></div>
    </div>
  </div>

  <!-- INCIDENTS -->
  <div class="section-label">‚ö†Ô∏è Verified Incidents</div>
  <div class="feed-list-wrap" id="feedList"></div>

  <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
    <a href="feed.html"><button class="active">
      <span class="material-symbols-rounded">dynamic_feed</span><small>Feed</small>
    </button></a>
    <a class="nav-center" href="index.html"><button class="nav-center-btn">
      <span class="material-symbols-rounded">map</span>
      <small>Map</small>
    </button></a>
    <a href="more.html"><button>
      <span class="material-symbols-rounded">more_horiz</span><small>More</small>
    </button></a>
  </nav>

</div>

<!-- COMMENT PANEL -->
<div class="comment-panel hidden" id="commentPanel">
  <header class="comment-panel-header">
    <button id="commentPanelClose">
      <span class="material-symbols-rounded">arrow_back</span>
    </button>
    <h3 id="commentPanelTitle">Comments</h3>
  </header>
  <div class="comment-list" id="commentList"></div>
  <div class="comment-input-bar">
    <input class="comment-name-input" id="commentName" placeholder="Your name (optional)" maxlength="40">
    <div class="comment-text-row">
      <textarea class="comment-text-input" id="commentText" placeholder="Write a comment‚Ä¶" rows="1"></textarea>
      <button class="comment-send-btn" id="commentSubmitBtn">
        <span class="material-symbols-rounded">send</span>
      </button>
    </div>
  </div>
  <input type="hidden" id="commentIncidentId">
</div>

<!-- Firebase SDK (compat mode) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="firebase-db.js"></script>
<script src="feed.js"></script>
<script>
// Demo CCTV data ‚Äì replace URLs with real streams when available
const cctvDemo = {
  'Magsaysay Ave': {
    img: 'CCTV_1.gif',
    sub: 'Cam 1 ¬∑ Centro District ¬∑ Clear traffic'
  },
  'Maharlika Highway': {
    img: '2131231.gif',  // ‚Üê add your image path here
    sub: 'Cam 2 ¬∑ Northbound ¬∑ Normal flow'
  },
  'Diversion Road': {
    img: '',  // ‚Üê add your image path here
    sub: 'Cam 3 ¬∑ East Naga ¬∑ Light traffic'
  },
  'Almeda Highway': {
    img: '',  // ‚Üê add your image path here
    sub: 'Cam 4 ¬∑ Southbound ¬∑ Moderate traffic'
  },
  'Pe√±afrancia Ave': {
    img: '',  // ‚Üê add your image path here
    sub: 'Cam 5 ¬∑ Shrine Area ¬∑ Clear'
  }
};

function openLiveArea(name, btn) {
  // Toggle off if already active
  const viewer = document.getElementById('cctvViewer');
  const pills  = document.querySelectorAll('.cctv-pill');

  const wasActive = btn.classList.contains('active');
  pills.forEach(p => p.classList.remove('active'));

  if (wasActive) {
    viewer.classList.remove('visible');
    return;
  }

  btn.classList.add('active');

  const data = cctvDemo[name] || { img: 'https://placehold.co/800x450/111/444?text=No+Signal', sub: '' };

  const imgEl = document.getElementById('liveMediaImg');
  const vidEl = document.getElementById('liveMediaVid');

  vidEl.style.display = 'none';
  imgEl.style.display = 'block';
  imgEl.src = data.img;

  document.getElementById('liveTitle').textContent = name;
  document.getElementById('liveSub').textContent   = data.sub;

  viewer.classList.add('visible');
  viewer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// openLiveArea is handled by feed.js

</script>
</body>
</html>
